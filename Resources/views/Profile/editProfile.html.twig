{% extends "ClarolineCoreBundle::layout.html.twig" %}

{% block title %}{{ 'profil_edition'|trans({}, 'platform') }}{% endblock %}

{% block content %}
    <div class="panel panel-default">
        <div class="panel-heading">
            <a href="{{ path('claro_profile_view') }}" class="black_link slrn-top-back-link">
                <i class="icon-chevron-left no_underline"> </i>{{ 'back_to_profile'|trans({}, 'platform') }}
            </a>
            <h3 class="slrn-content-main-title">{{ 'profil_edition'|trans({}, 'platform') }}</h3>
        </div>
        {% set actionForm = editYourself ? path('claro_user_profile_edit') : path('claro_user_profile_edit', {'user': user.getId()}) %}
        {% set cancelUrl  = editYourself ? path('claro_profile_view') : path('claro_admin_user_list') %}
        {{ macros.flashBox() }}
        <form role="form" class="form-horizontal" action="{{ actionForm }}" method="post" {{ form_enctype(form) }} id="profile_form">
            <div class="panel-body slrn-profile-form">
                {# FIRST NAME #}
                <div class="form-group row">
                    {{ form_label(form.firstName) }}
                    <div class="col-md-9 col-xs-9">
                        {{ form_widget(form.firstName) }}
                        {{ form_errors(form.firstName) }} 
                    </div>
                </div>
                {# LAST  NAME #}
                <div class="form-group row">
                    {{ form_label(form.lastName) }}
                    <div class="col-md-9 col-xs-9">
                        {{ form_widget(form.lastName) }}
                        {{ form_errors(form.lastName) }} 
                    </div>
                </div>
                {# USERNAME #}
                <div class="form-group row">
                    {{ form_label(form.username) }}
                    <div class="col-md-9 col-xs-9">
                        {{ form_widget(form.username) }}
                        {{ form_errors(form.username) }} 
                    </div>
                </div>
                {# MAIL  #}
                <div class="form-group row">
                    {{ form_label(form.mail) }}
                    <div class="col-md-9 col-xs-9">
                        {{ form_widget(form.mail) }}
                        {{ form_errors(form.mail) }} 
                    </div>
                </div>
                {# CURRENT PROFILE PICTURE #}
                {% if form.picture.vars.value %}
                    <div class="form-group row hide">
                    {{ form_label(form.picture) }}
                    <div class="col-md-9 col-xs-9">
                        {{ form_widget(form.picture) }}
                        {{ form_errors(form.picture) }} 
                    </div>
                    </div>
                    <div class="form-group row">
                        <label class="control-label col-md-3">
                            {{ 'current_picture_profile'|trans({}, 'platform')}}
                        </label>
                        <div class="cold-md-9 col-xs-9">
                            <img src="{{ image( 'uploads/pictures/' ~ form.picture.vars.value ).zoomCrop( 150, 150 ) }}" width="150" height="150">
                        </div>
                    </div>
                {% endif %}
                {# PICTURE INPUT #}
                <div class="form-group row hide">
                    {{ form_label(form.pictureFile) }}
                    <div class="col-md-9 col-xs-9">
                        {{ form_widget(form.pictureFile) }}
                        {{ form_errors(form.pictureFile) }}
                    </div>
                </div>
                {#Â UPLOAD BUTTON #}
                <div class="form-group row">
                    <label class="control-label col-md-3">
                        {{ 'picture_profile'|trans({}, 'platform')}}
                    </label>
                    <div class="cold-md-9 col-xs-9">
                        <a id="js-upload-file" class="btn btn-gris">{{ 'edit_profile_upload'|trans({}, 'platform')}}</a>
                        <span class="slrn-upload-file-name">
                            {% if form.picture.vars.value %}
                                {{ form.picture.vars.value }}
                            {% else %}
                                {{ 'edit_profile_upload_file_name'|trans({}, 'platform') }}
                            {% endif %}
                        </span>
                    </div>
                </div>
                <script>
                    jQuery(document).ready( function() {
                        hiddenUploadField = jQuery('#profile_form_pictureFile');
                        
                        jQuery('#js-upload-file').on( 'click', function() {
                            hiddenUploadField.click();
                        });
                        
                        hiddenUploadField.change( function() {
                            fileName = hiddenUploadField.val().split('\\');
                            jQuery('.slrn-upload-file-name').html( fileName[fileName.length-1] );
                        });
                        
                                
                    });
                </script>
                {# DESCRIPTION #}
                <div class="form-group row">
                    {{ form_label(form.description) }}
                    <div class="col-md-9 col-xs-9">
                        {{ form_widget(form.description) }}
                        {{ form_errors(form.description) }} 
                    </div>
                </div>
                {# OPTIN #}
                {% if profile_form.accepted_com_terms is defined %}
                <div class="form-group row">
                    {{ form_label(form.accepted_com_terms) }}
                    <div class="col-md-9 col-xs-9">
                        {{ form_widget(form.accepted_com_terms) }}
                        {{ form_errors(form.accepted_com_terms) }} 
                    </div>
                </div>
                {% endif %}
                {# CACHE : ADMINISTRATIVE CODE #}
                <div class="form-group row hide">
                    {{ form_label(form.administrativeCode, label|default(null), { 'label_attr' : { 'class': 'hide' } } ) }}
                    <div class="col-md-3 col-xs-3">
                       {{ form_widget(form.administrativeCode, {'attr': { 'class' : 'hide' } }) }}
                    </div>
                </div>           
                {# CACHE : TELEPHONE  #}
                <div class="form-group row hide">
                    {{ form_label(form.phone, label|default(null), { 'label_attr' : { 'class': 'hide' } } ) }}
                    <div class="col-md-3 col-xs-3">
                       {{ form_widget(form.phone, {'attr': { 'class' : 'hide' } }) }}
                    </div>
                </div>
                {# CACHE : LOCALE  #}{#
                <div class="form-group row">
                    {{ form_label(form.locale, label|default(null), { 'label_attr' : { 'class': '' } } ) }}
                    <div class="col-md-3 col-xs-3">
                       {{ form_widget(form.locale, {'attr': { 'class' : '' } }) }}
                    </div>
                </div>#}
                {# CACHE : PLATFORM ROLES  #}
                {# TODO : ALLOW ADMIN TO CHANGE ROLE #}
                {% if form.platformRoles is defined %}
                    <div class="form-group row">
                        {{ form_label(form.platformRoles, label|default(null) ) }}
                        <div class="col-md-3 col-xs-3">
                           {{ form_widget(form.platformRoles) }}
                        </div>
                    </div> 
                {% endif %}
                {# CACHE : TOKEN #}                 
                <div class="form-group row hide">
                    {{ form_label(form._token, label|default(null), { 'label_attr' : { 'class': 'hide' } } ) }}
                    <div class="col-md-9 col-xs-9 slrn-accepted-terms">
                        {{ form_widget(form._token, {'attr': { 'class' : 'hide' } } ) }}
                    </div>
                </div>
            </div>
            <div class="form-group row slrn-form-group-button">
                <div class="col-md-3 col-xs-3"></div>
                <div class="col-md-9 col-xs-9">
                    <button type="submit" class="btn btn-primary">{{ 'edit'|trans({}, 'platform') }}</button>
                    <a href="{{ path('claro_profile_view') }}" class="btn btn-gris" role="button">{{ 'cancel' | trans({}, 'platform') }}</a>
                </div>
            </div>
        </form>
    </div>
    <hr class="slrn-hr--lightgrey">
    <div class="slrn-unsubscribe">
        {{ 'user_wish_to_unsubscribe'|trans({}, 'platform') }}
        <a class="pink_link" href="{{path('claro_user_delete', { 'userId': app.user.getId() } )}}">
            {{ 'unsubscribe_self'|trans({}, 'platform' )}}
        </a>
    </div>
{% endblock %}
